<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <title>My diary</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/cover/">

    <!-- Bootstrap core CSS -->
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
    </style>
		
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>	
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/js/tempusdominus-bootstrap-4.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.0.1/css/tempusdominus-bootstrap-4.min.css" />	
	
    <!-- Custom styles for this template -->
    <link href="css/cover.css" rel="stylesheet">
	<link href="css/arrows.css" rel="stylesheet">
	<link href="css/diary.css" rel="stylesheet">
  </head>
  <body class="text-center" onload="baseLoad()">
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
  <header class="masthead">
    <div class="inner">
      <h3 class="masthead-brand">My diary</h3>
      <nav class="nav nav-masthead justify-content-center">
        <a class="nav-link active" href="index.html">Home</a>
        <!-- <a class="nav-link" href="#">Features</a>
        <a class="nav-link" href="#">Contact</a> -->
      </nav>
    </div>
  </header>

  <main role="main" class="">
	<div class="form group">
		<div class="row">
			<div class="col-md-12">
			<p>Just write, for yourself</p>
			</div>
		</div>	
		<div class="row">
		  <div class="col-xs-6 col-md-4">
			<a href="#" class="previous round" title="yesterday" onclick="dateYesterday()" >&#8249;</a>	  
		  </div>
		  <div class="col-xs-6 col-md-4">
			<div class="form-group">
				<div class="input-group date" id="datetimepicker1" data-target-input="nearest">
					<input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker1"/>
					<div class="input-group-append" data-target="#datetimepicker1" data-toggle="datetimepicker">
						<div class="input-group-text"><i class="fa fa-calendar"></i></div>
					</div>
				</div>
			</div>		
			<script type="text/javascript">
				$(function () {
					$('#datetimepicker1').datetimepicker({
						format: 'DD/MM/YYYY'					
					});
				});
			</script>		
		  </div>
		  <div class="col-xs-6 col-md-4">
			<a href="#" class="next round" title="tomorrow" onclick="dateTomorrow()">&#8250;</a>	  
		  </div>
		</div>	
	</div>
	<div class="form-group">	
		<textarea id="diaryArea" class="form-control diary-area" rows="20" cols="50" autofocus placeholder="Write your notes for today.."></textarea>
	</div>
	<div class="row">
		<div id="savingIndicator" class="col-md-12">
		Saving...
		</div>
		<!-- <button id="saveButton" onclick="save()">save</button> -->
	</div>	
	</div>

  </main>

  <footer class="mastfoot mt-auto">
  </footer>
</div>
</body>
<script type="text/javascript">
	function baseLoad() {
		$('#datetimepicker1').datetimepicker({
		    format: 'DD/MM/YYYY'
		});
		loadFromStorage();
		// auto-save 
		//$('#savingIndicator').hide();
		var timer = '';

		$('#diaryArea').keypress(function() {
			var _this = $(this); // copy of this object for further usage
			clearTimeout(timer);
			timer = setTimeout(function() {
				//$('#savingIndicator').show();
				save();
			}, 3000);
		});
	}
	
	function dateYesterday(){
		let yesterday = $('#datetimepicker1').datetimepicker('date').subtract(1,"days");
		$('#datetimepicker1').datetimepicker('date',yesterday);
		loadContent(yesterday.format("DD/MM/YYYY"))
	}
	
	function dateTomorrow(){
		let tomorrow = $('#datetimepicker1').datetimepicker('date').add(1,"days");
		$('#datetimepicker1').datetimepicker('date',tomorrow);
		loadContent(tomorrow.format("DD/MM/YYYY"))
	}
	
	function loadFromStorage(){
		var lastDate = localStorage.lastDate;
		if (lastDate === null || lastDate === undefined){
			lastDate = new Date();	
		}
		$('#datetimepicker1').datetimepicker('date', moment(new Date(), 'DD/MM/YYYY') );
		loadContent(new Date());
	}
	
	function loadContent(lastDate){
		var content = localStorage[lastDate];
		if (content !== null && content !== undefined){
			$("#diaryArea").val(content);
		} else {
			$("#diaryArea").val("");
		}
	}
	
	function save(){
		// save current date
		var lastDate = $('#datetimepicker1').datetimepicker('date').format("DD/MM/YYYY");
		localStorage.lastDate = lastDate;
		var value = $("#diaryArea").val();
		localStorage[lastDate] = value;
		console.log("data saved")
	}
</script>
</html>
